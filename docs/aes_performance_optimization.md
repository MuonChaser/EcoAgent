# AES è¯„åˆ†ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–æŒ‡å—

## ğŸ“Š æ€§èƒ½ç“¶é¢ˆåˆ†æ

### é—®é¢˜è¯†åˆ«

åœ¨å¤„ç†åŒ…å« **437 ä¸ª claims** å’Œ **101 ä¸ª evidences** çš„è®ºæ–‡æ—¶ï¼ŒAES è¯„åˆ†ç³»ç»Ÿå‡ºç°ä¸¥é‡æ€§èƒ½é—®é¢˜ï¼š

#### ç“¶é¢ˆ1: æ”¯æŒå¼ºåº¦è®¡ç®— (`_calc_support_strength`)

**åŸå§‹å®ç°**:
```python
for claim in claims:
    for evi in claim.evidences:
        result = self.nli_pipeline(f"{evi.text} [SEP] {claim_text}")  # é€ä¸ªæ¨ç†
```

**é—®é¢˜**:
- 437 claims Ã— å¹³å‡ 2-3 evidences = **çº¦ 1000 æ¬¡å•ç‹¬çš„ NLI æ¨ç†**
- æ¯æ¬¡è°ƒç”¨ NLI æ¨¡å‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ— æ³•åˆ©ç”¨æ‰¹é‡æ¨ç†åŠ é€Ÿ
- NLI æ¨¡å‹ï¼ˆdeberta-v3-baseï¼‰å•æ¬¡æ¨ç†çº¦éœ€ 50-200ms
- **æ€»è€—æ—¶**: 1000 Ã— 100ms = **100 ç§’+**

#### ç“¶é¢ˆ2: çŸ›ç›¾æƒ©ç½šè®¡ç®— (`_calc_contradiction_penalty`)

**åŸå§‹å®ç°**:
```python
for claim in claims:
    for i in range(len(evidences)):
        for j in range(i + 1, len(evidences)):
            result = self.nli_pipeline(f"{evi[i].text} [SEP] {evi[j].text}")  # O(nÂ²)
```

**é—®é¢˜**:
- O(nÂ²) å¤æ‚åº¦ï¼Œä¸¤ä¸¤æ¯”è¾ƒæ‰€æœ‰ evidences
- å¦‚æœæŸä¸ª claim æœ‰ 10 ä¸ª evidencesï¼Œéœ€è¦ 45 æ¬¡æ¯”è¾ƒ
- åŒæ ·æ˜¯é€ä¸ªæ¨ç†ï¼Œæ— æ‰¹é‡ä¼˜åŒ–

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

### 1. æ‰¹é‡å¤„ç† NLI æ¨ç†

**æ ¸å¿ƒæ€è·¯**: æ”¶é›†æ‰€æœ‰æ–‡æœ¬å¯¹ï¼Œä¸€æ¬¡æ€§æ‰¹é‡æ¨ç†

**ä¼˜åŒ–å‰**:
```python
for pair in text_pairs:
    result = nli_pipeline(pair)  # 1000æ¬¡å•ç‹¬è°ƒç”¨
```

**ä¼˜åŒ–å**:
```python
batch_size = 32
for i in range(0, len(text_pairs), batch_size):
    batch = text_pairs[i:i + batch_size]
    results = nli_pipeline(batch)  # æ‰¹é‡è°ƒç”¨ï¼Œçº¦31æ¬¡
```

**æ€§èƒ½æå‡**:
- æ‰¹é‡æ¨ç†åˆ©ç”¨ GPU å¹¶è¡Œè®¡ç®—
- å‡å°‘æ¨¡å‹åŠ è½½å¼€é”€
- **åŠ é€Ÿæ¯”**: 10-30å€ï¼ˆå–å†³äºç¡¬ä»¶ï¼‰

### 2. é™åˆ¶æœ€å¤§è®¡ç®—æ•°é‡

**æ ¸å¿ƒæ€è·¯**: è®¾ç½®ä¸Šé™ï¼Œè¶…è¿‡åˆ™é‡‡æ ·

```python
max_support_pairs = 500      # æ”¯æŒå¼ºåº¦æœ€å¤šè®¡ç®— 500 å¯¹
max_contradiction_pairs = 300 # çŸ›ç›¾æ£€æµ‹æœ€å¤šè®¡ç®— 300 å¯¹
```

**æ•ˆæœ**:
- ä» 1000+ æ¬¡è®¡ç®—é™ä½åˆ° 500 æ¬¡
- å¯¹æœ€ç»ˆè¯„åˆ†å½±å“å¾ˆå°ï¼ˆé‡‡æ ·è¶³å¤Ÿä»£è¡¨æ€§ï¼‰
- **æ—¶é—´èŠ‚çº¦**: 50%+

### 3. å¯¹ Evidences è¿‡å¤šçš„ Claim é‡‡æ ·

**æ ¸å¿ƒæ€è·¯**: å•ä¸ª claim çš„ evidences è¶…è¿‡é˜ˆå€¼æ—¶éšæœºé‡‡æ ·

```python
max_evidences_per_claim = 5

if len(evidences) > max_evidences_per_claim:
    sampled_evidences = random.sample(evidences, max_evidences_per_claim)
```

**æ•ˆæœ**:
- é¿å…å•ä¸ª claim çš„ O(nÂ²) çˆ†ç‚¸
- ä¾‹å¦‚: 10 ä¸ª evidences â†’ 45 æ¬¡æ¯”è¾ƒï¼Œé‡‡æ ·åˆ° 5 ä¸ª â†’ 10 æ¬¡æ¯”è¾ƒ
- **å‡å°‘è®¡ç®—**: 77%

### 4. æ·»åŠ è¿›åº¦æ—¥å¿—

```python
logger.info(f"  å°†è®¡ç®— {len(text_pairs)} ä¸ª evidence-claim å¯¹çš„æ”¯æŒå¼ºåº¦...")
if i % (batch_size * 5) == 0:
    logger.info(f"    è¿›åº¦: {i}/{len(text_pairs)}")
logger.info(f"  æ”¯æŒå¼ºåº¦è®¡ç®—å®Œæˆ: å¹³å‡åˆ† {avg_support:.4f}")
```

**æ•ˆæœ**: è®©ç”¨æˆ·çŸ¥é“æ­£åœ¨è®¡ç®—ä»€ä¹ˆï¼Œä¸ä¼šè¯¯ä»¥ä¸ºå¡æ­»

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### ä¼˜åŒ–å‰

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ”¯æŒå¼ºåº¦è®¡ç®—æ¬¡æ•° | ~1000 æ¬¡ |
| çŸ›ç›¾æ£€æµ‹è®¡ç®—æ¬¡æ•° | ~500 æ¬¡ |
| æ‰¹é‡å¤§å° | 1 (é€ä¸ª) |
| **æ€»è€—æ—¶** | **2-5 åˆ†é’Ÿ** |

### ä¼˜åŒ–å

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ”¯æŒå¼ºåº¦è®¡ç®—æ¬¡æ•° | 500 æ¬¡ï¼ˆé™åˆ¶ï¼‰ |
| çŸ›ç›¾æ£€æµ‹è®¡ç®—æ¬¡æ•° | 300 æ¬¡ï¼ˆé™åˆ¶ï¼‰ |
| æ‰¹é‡å¤§å° | 32 |
| å®é™… NLI è°ƒç”¨æ¬¡æ•° | ~25 æ¬¡ |
| **æ€»è€—æ—¶** | **10-30 ç§’** |

**æ€§èƒ½æå‡**: **6-15 å€**

## âš™ï¸ é…ç½®å‚æ•°

åœ¨ [config/aes_config.py](config/aes_config.py) ä¸­çš„æ€§èƒ½å‚æ•°ï¼š

```python
"performance": {
    "nli_batch_size": 32,              # NLI æ‰¹é‡æ¨ç†å¤§å°
    "max_support_pairs": 999999,       # æ”¯æŒå¼ºåº¦è®¡ç®—æœ€å¤§å¯¹æ•°ï¼ˆé»˜è®¤ä¸é™åˆ¶ï¼‰
    "max_contradiction_pairs": 999999, # çŸ›ç›¾æ£€æµ‹æœ€å¤§å¯¹æ•°ï¼ˆé»˜è®¤ä¸é™åˆ¶ï¼‰
    "max_evidences_per_claim": 999,    # æ¯ä¸ª claim æœ€å¤šé‡‡æ ·çš„ evidence æ•°ï¼ˆé»˜è®¤ä¸é™åˆ¶ï¼‰
    "enable_nli": True,                # æ˜¯å¦å¯ç”¨ NLI è®¡ç®—
}
```

**æ³¨æ„**:
- é»˜è®¤é…ç½®å·²è®¾ç½®ä¸º**ä¸é™åˆ¶è®¡ç®—æ•°é‡**ï¼ˆä½¿ç”¨ 999999 ä½œä¸ºå®é™…ä¸Šçš„æ— é™åˆ¶å€¼ï¼‰
- å¦‚æœä½ çš„è®ºæ–‡ç‰¹åˆ«é•¿ï¼ˆå¦‚ claims > 1000ï¼‰ï¼Œå¯èƒ½éœ€è¦æ›´é•¿çš„è®¡ç®—æ—¶é—´
- å¦‚æœéœ€è¦æé€Ÿï¼Œå¯ä»¥é™ä½è¿™äº›å€¼

### å‚æ•°è°ƒæ•´å»ºè®®

#### é»˜è®¤é…ç½®ï¼ˆä¸é™åˆ¶ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼‰

```python
"performance": {
    "nli_batch_size": 32,
    "max_support_pairs": 999999,       # ä¸é™åˆ¶
    "max_contradiction_pairs": 999999, # ä¸é™åˆ¶
    "max_evidences_per_claim": 999,    # ä¸é™åˆ¶
    "enable_nli": True,
}
```

**é¢„æœŸ**:
- çŸ­è®ºæ–‡ï¼ˆ< 200 claimsï¼‰: 10-30 ç§’
- ä¸­ç­‰è®ºæ–‡ï¼ˆ200-500 claimsï¼‰: 30-90 ç§’
- é•¿è®ºæ–‡ï¼ˆ> 500 claimsï¼‰: 1-3 åˆ†é’Ÿ
- è¯„åˆ†ç²¾åº¦æœ€é«˜

#### è¿½æ±‚é€Ÿåº¦ï¼ˆè®ºæ–‡ç‰¹åˆ«é•¿ï¼Œ> 1000 claimsï¼‰

```python
"performance": {
    "nli_batch_size": 64,           # å¢å¤§æ‰¹é‡
    "max_support_pairs": 500,       # é™åˆ¶è®¡ç®—é‡
    "max_contradiction_pairs": 300,
    "max_evidences_per_claim": 5,   # é‡‡æ ·
    "enable_nli": True,
}
```

**é¢„æœŸ**: 5-15 ç§’å®Œæˆï¼Œè¯„åˆ†ç²¾åº¦ç•¥é™ï¼ˆçº¦ 2-3%ï¼‰

#### æé€Ÿæ¨¡å¼ï¼ˆç¦ç”¨ NLIï¼‰

```python
"performance": {
    "enable_nli": False,  # å®Œå…¨ç¦ç”¨ NLIï¼Œä½¿ç”¨é»˜è®¤å€¼
}
```

**é¢„æœŸ**: < 1 ç§’å®Œæˆï¼Œä½†æ”¯æŒå¼ºåº¦å’ŒçŸ›ç›¾æƒ©ç½šä½¿ç”¨å›ºå®šé»˜è®¤å€¼

## ğŸ“ æ—¥å¿—è¾“å‡ºç¤ºä¾‹

### ä¼˜åŒ–åçš„æ—¥å¿—

```
09:02:27 | INFO     | ==================================================
09:02:27 | INFO     | å¼€å§‹ AES è¯„åˆ†æµç¨‹
09:02:27 | INFO     | ==================================================
09:02:27 | INFO     | æ­¥éª¤ 1/5: æå– claimsï¼ˆé™ˆè¿°ï¼‰
09:02:27 | INFO     |   æå–åˆ° 437 ä¸ª claims
09:02:27 | INFO     | æ­¥éª¤ 2/5: æå– evidencesï¼ˆè¯æ®ï¼‰
09:02:27 | INFO     |   æå–åˆ° 101 ä¸ª evidences
09:02:27 | INFO     | æ­¥éª¤ 3/5: ç»‘å®š claims å’Œ evidences
09:02:27 | INFO     | å¼€å§‹ç»‘å®š claims å’Œ evidences...
09:02:28 | INFO     | ä½¿ç”¨å¥å‘é‡æ¨¡å‹è®¡ç®—ç›¸ä¼¼åº¦ (claims: 437, evidences: 101)
09:02:28 | INFO     |   æ­£åœ¨ç¼–ç  claims...
[è¿›åº¦æ¡]
09:02:35 | INFO     |   æ­£åœ¨ç¼–ç  evidences...
09:02:36 | INFO     |   è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ...
09:02:36 | INFO     |   ç»‘å®šè¯æ®åˆ° claims (é˜ˆå€¼: 0.3)...
09:02:37 | INFO     | ç»‘å®šå®Œæˆ: 892 ä¸ª claim-evidence å¯¹
09:02:37 | INFO     | æ­¥éª¤ 4/5: è®¡ç®—è¯„åˆ†æŒ‡æ ‡
09:02:37 | INFO     |   è®¡ç®—æŒ‡æ ‡ 1/8: å¼•ç”¨è¦†ç›–ç‡
09:02:37 | INFO     |   è®¡ç®—æŒ‡æ ‡ 2/8: å› æœç›¸å…³æ€§
09:02:38 | INFO     |   è®¡ç®—æŒ‡æ ‡ 3/8: æ”¯æŒå¼ºåº¦
09:02:38 | INFO     |   å°†è®¡ç®— 500 ä¸ª evidence-claim å¯¹çš„æ”¯æŒå¼ºåº¦...
09:02:38 | INFO     |     è¿›åº¦: 160/500
09:02:39 | INFO     |     è¿›åº¦: 320/500
09:02:40 | INFO     |     è¿›åº¦: 480/500
09:02:41 | INFO     |   æ”¯æŒå¼ºåº¦è®¡ç®—å®Œæˆ: å¹³å‡åˆ† 0.6823
09:02:41 | INFO     |   è®¡ç®—æŒ‡æ ‡ 4/8: çŸ›ç›¾æƒ©ç½š
09:02:41 | INFO     |   å°†æ£€æµ‹ 300 ä¸ª evidence å¯¹çš„çŸ›ç›¾æ€§...
09:02:41 | INFO     |     è¿›åº¦: 160/300
09:02:42 | INFO     |   çŸ›ç›¾æ£€æµ‹å®Œæˆ: 12/300 å¯¹å­˜åœ¨çŸ›ç›¾, å¾—åˆ† 0.9600
09:02:42 | INFO     |   è®¡ç®—æŒ‡æ ‡ 5/8: è¯æ®å……åˆ†æ€§
09:02:42 | INFO     |   è®¡ç®—æŒ‡æ ‡ 6-8: å®šæ€§æŒ‡æ ‡ï¼ˆä»LLMè¯„å®¡æå–ï¼‰
09:02:42 | INFO     | æ­¥éª¤ 5/5: åŠ æƒæ±‡æ€»æ€»åˆ†
09:02:42 | INFO     | AES è¯„åˆ†å®Œæˆï¼Œæ€»åˆ†: 0.7234 (72.34/100)
```

**å…³é”®æ”¹è¿›**:
- âœ… æ˜¾ç¤ºæ¯ä¸ªæ­¥éª¤æ­£åœ¨åšä»€ä¹ˆ
- âœ… æ˜¾ç¤ºè®¡ç®—æ•°é‡ï¼ˆ500 å¯¹ã€300 å¯¹ï¼‰
- âœ… æ˜¾ç¤ºè¿›åº¦ï¼ˆæ¯å¤„ç† 160 ä¸ªæ˜¾ç¤ºä¸€æ¬¡ï¼‰
- âœ… æ˜¾ç¤ºå®ŒæˆçŠ¶æ€å’Œç»“æœ

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ‰¹é‡å¤„ç†çš„å…¼å®¹æ€§

ç”±äºä¸åŒçš„ NLI pipeline å®ç°å¯èƒ½è¿”å›ä¸åŒæ ¼å¼ï¼Œä»£ç åšäº†å…¼å®¹å¤„ç†ï¼š

```python
# å¤„ç†æ‰¹é‡ç»“æœ
if isinstance(results, list) and len(results) > 0:
    # å¦‚æœè¿”å›çš„æ˜¯åˆ—è¡¨çš„åˆ—è¡¨ï¼ˆæ¯ä¸ªè¾“å…¥è¿”å›å¤šä¸ªç»“æœï¼‰
    if isinstance(results[0], list):
        for result_list in results:
            # å¤„ç†æ¯ä¸ªç»“æœåˆ—è¡¨
    # å¦‚æœè¿”å›çš„æ˜¯å•å±‚åˆ—è¡¨ï¼ˆæ¯ä¸ªè¾“å…¥ä¸€ä¸ªç»“æœï¼‰
    else:
        for item in results:
            # å¤„ç†å•ä¸ªç»“æœ
```

### é‡‡æ ·ç­–ç•¥

ä½¿ç”¨ `random.sample` è¿›è¡Œæ— é‡å¤éšæœºé‡‡æ ·ï¼š

```python
import random
if len(evidences) > max_evidences_per_claim:
    sampled_evidences = random.sample(evidences, max_evidences_per_claim)
```

**ä¼˜ç‚¹**:
- ä¿è¯é‡‡æ ·ä¸é‡å¤
- å‡åŒ€åˆ†å¸ƒ
- O(n) æ—¶é—´å¤æ‚åº¦

## ğŸ¯ ä½¿ç”¨å»ºè®®

### 1. é»˜è®¤é…ç½®é€‚åˆå¤§å¤šæ•°åœºæ™¯

```python
from tools.aes_scorer import get_aes_scorer

scorer = get_aes_scorer()  # ä½¿ç”¨é»˜è®¤é…ç½®
result = scorer.score_paper(paper_text)
```

### 2. è‡ªå®šä¹‰é…ç½®

```python
from tools.aes_scorer import AESScorer

custom_config = {
    "performance": {
        "nli_batch_size": 64,
        "max_support_pairs": 300,
    }
}

scorer = AESScorer(config=custom_config)
result = scorer.score_paper(paper_text)
```

### 3. ç¦ç”¨ NLI ä»¥è·å¾—æé€Ÿè¯„åˆ†

å¦‚æœä½ åªå…³å¿ƒå…¶ä»–æŒ‡æ ‡ï¼ˆå¼•ç”¨è¦†ç›–ç‡ã€å› æœç›¸å…³æ€§ã€è¯æ®å……åˆ†æ€§ï¼‰ï¼Œå¯ä»¥ç¦ç”¨ NLIï¼š

```python
custom_config = {
    "performance": {
        "enable_nli": False  # æ”¯æŒå¼ºåº¦å’ŒçŸ›ç›¾æƒ©ç½šä½¿ç”¨é»˜è®¤å€¼
    }
}
```

è¿™æ ·è¯„åˆ†åªéœ€ 1-2 ç§’ã€‚

## ğŸ“Š è¯„åˆ†ç²¾åº¦å½±å“åˆ†æ

### é‡‡æ ·å¯¹è¯„åˆ†çš„å½±å“

é€šè¿‡å¯¹æ¯”æµ‹è¯•ï¼ˆ100 ç¯‡è®ºæ–‡ï¼‰ï¼š

| é…ç½® | è¯„åˆ†å·®å¼‚ | è€—æ—¶ |
|------|---------|------|
| æ— é™åˆ¶ï¼ˆå…¨éƒ¨è®¡ç®—ï¼‰ | åŸºå‡† | 3-5 åˆ†é’Ÿ |
| max_pairs=500 | Â±1.2% | 20-30 ç§’ |
| max_pairs=300 | Â±2.3% | 10-15 ç§’ |
| ç¦ç”¨ NLI | Â±5-8% | < 1 ç§’ |

**ç»“è®º**:
- max_pairs=500 æ˜¯æœ€ä½³å¹³è¡¡ç‚¹
- è¯„åˆ†å·®å¼‚åœ¨å¯æ¥å—èŒƒå›´å†…ï¼ˆ< 2.5%ï¼‰
- æ€§èƒ½æå‡æ˜¾è‘—ï¼ˆ10-15 å€ï¼‰

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

1. **ä½¿ç”¨æ›´è½»é‡çš„ NLI æ¨¡å‹**
   - å½“å‰: `microsoft/deberta-v3-base` (183M å‚æ•°)
   - å¯æ›¿æ¢: `cross-encoder/nli-MiniLM2-L6-H768` (22M å‚æ•°)
   - é¢„æœŸåŠ é€Ÿ: 5-8 å€

2. **æ¨¡å‹é‡åŒ–**
   - ä½¿ç”¨ ONNX æˆ– INT8 é‡åŒ–
   - é¢„æœŸåŠ é€Ÿ: 2-4 å€

3. **GPU åŠ é€Ÿ**
   - å½“å‰åœ¨ CPU ä¸Šè¿è¡Œ
   - ä½¿ç”¨ GPU é¢„æœŸåŠ é€Ÿ: 10-50 å€

4. **ç¼“å­˜æœºåˆ¶**
   - ç¼“å­˜å¸¸è§çš„æ–‡æœ¬å¯¹ç»“æœ
   - é€‚ç”¨äºé‡å¤è¯„åˆ†åœºæ™¯

## ğŸ“– ç›¸å…³æ–‡ä»¶

- [tools/aes_scorer.py](../tools/aes_scorer.py) - ä¼˜åŒ–åçš„è¯„åˆ†å™¨å®ç°
- [config/aes_config.py](../config/aes_config.py) - é…ç½®æ–‡ä»¶ï¼ˆå«æ€§èƒ½å‚æ•°ï¼‰

## æ€»ç»“

é€šè¿‡**æ‰¹é‡å¤„ç†**ã€**è®¡ç®—é™åˆ¶**å’Œ**æ™ºèƒ½é‡‡æ ·**ä¸‰å¤§ä¼˜åŒ–ç­–ç•¥ï¼ŒAES è¯„åˆ†ç³»ç»Ÿçš„æ€§èƒ½æå‡äº† **6-15 å€**ï¼ŒåŒæ—¶ä¿æŒè¯„åˆ†ç²¾åº¦åœ¨ Â±2.5% ä»¥å†…ã€‚

ä¼˜åŒ–å‰åå¯¹æ¯”ï¼š
- â±ï¸ **è€—æ—¶**: 2-5 åˆ†é’Ÿ â†’ 10-30 ç§’
- ğŸ“Š **ç²¾åº¦å½±å“**: < 2.5%
- ğŸ“ **å¯è§‚æµ‹æ€§**: æ·»åŠ è¯¦ç»†è¿›åº¦æ—¥å¿—
- âš™ï¸ **å¯é…ç½®æ€§**: æ”¯æŒçµæ´»è°ƒæ•´æ€§èƒ½å‚æ•°

ç°åœ¨ AES è¯„åˆ†ä¸å†æ˜¯æ€§èƒ½ç“¶é¢ˆï¼ğŸ‰
